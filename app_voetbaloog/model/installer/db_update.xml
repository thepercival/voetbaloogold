<?xml version="1.0" encoding="UTF-8"?>
<db>
	<Additions>
		<Version>V1.01</Version>
		<Addition>
			<Name>ColumnAdd</Name>
			<table>
				<Name>UsersExt</Name>
				<Columns>
					<Column>
						<Name>FacebookId</Name>
						<Datatype>varchar</Datatype>
						<Length>50</Length>
						<Nullable>Y</Nullable>
					</Column>
					<Column>
						<Name>Salted</Name>
						<Datatype>tinyint</Datatype>
						<DefaultValue>0</DefaultValue>
						<Nullable>N</Nullable>
						<DefaultValueName>DF_UsersExt_Salted</DefaultValueName>
					</Column>
					<Column>
						<Name>Picture</Name>
						<Datatype>blob</Datatype>
						<Nullable>Y</Nullable>
					</Column>
					<Column>
						<Name>EmailAddress</Name>
						<Datatype>varchar</Datatype>
						<Length>100</Length>
						<Nullable>Y</Nullable>
					</Column>
					<Column>
						<Name>Gender</Name>
						<Datatype>varchar</Datatype>
						<Length>1</Length>
						<Nullable>Y</Nullable>
					</Column>
					<Column>
						<Name>DateOfBirth</Name>
						<Datatype>datetime</Datatype>
						<Nullable>Y</Nullable>
					</Column>
					<Column>
						<Name>ActivationKey</Name>
						<Datatype>varchar</Datatype>
						<Length>128</Length>
						<Nullable>Y</Nullable>
					</Column>
					<Column>
						<Name>HashType</Name>
						<Datatype>varchar</Datatype>
						<Length>10</Length>
						<Nullable>N</Nullable>
						<DefaultValue>'sha512'</DefaultValue>
						<DefaultValueName>DF_UsersExt_HashType</DefaultValueName>
					</Column>
					<Column>
						<Name>GoogleId</Name>
						<Datatype>varchar</Datatype>
						<Length>50</Length>
						<Nullable>Y</Nullable>
					</Column>
					<Column>
						<Name>TwitterId</Name>
						<Datatype>varchar</Datatype>
						<Length>50</Length>
						<Nullable>Y</Nullable>
					</Column>
					<Column>
						<Name>CookieSessionToken</Name>
						<Datatype>varchar</Datatype>
						<Length>128</Length>
						<Nullable>Y</Nullable>
					</Column>
					<Column>
						<Name>PeriodicEmail</Name>
						<Datatype>tinyint</Datatype>
						<DefaultValue>1</DefaultValue>
						<Nullable>N</Nullable>
						<DefaultValueName>DF_UsersExt_PeriodicEmail</DefaultValueName>
					</Column>
				</Columns>
			</table>
		</Addition>
	</Additions>
	<!-- continue here
	<Additions>
		<Version>V1.22</Version>
	</Additions> -->
	<Additions>
		<Version>V1.38</Version>
		<Addition>
			<Name>KeyRemove</Name>
			<table>
				<Name>Rounds</Name>
				<Keys>
					<Key>
						<Name>UK_Rounds_2</Name>
						<TypeE>UNIQUE</TypeE>
					</Key>
				</Keys>
			</table>
		</Addition>
	</Additions>
	<Additions>
		<Version>V1.39</Version>
		<Addition>
			<Name>ColumnUpdate</Name>
			<table>
				<Name>Rounds</Name>
				<Columns>
					<Column>
						<Name>Name</Name>
						<Datatype>varchar</Datatype>
						<Length>20</Length>
						<Nullable>Y</Nullable>
					</Column>
				</Columns>
			</table>
		</Addition>
	</Additions>
	<Additions>
		<Version>V1.40</Version>
		<Addition>
			<Name>KeyRemove</Name>
			<table>
				<Name>Poules</Name>
				<Keys>
					<Key>
						<Name>UK_Poules_1</Name>
						<TypeE>UNIQUE</TypeE>
					</Key>
				</Keys>
			</table>
		</Addition>
	</Additions>
	<Additions>
		<Version>V1.41</Version>
		<Addition>
			<Name>ColumnUpdate</Name>
			<table>
				<Name>Poules</Name>
				<Columns>
					<Column>
						<Name>Name</Name>
						<Datatype>varchar</Datatype>
						<Length>20</Length>
						<Nullable>Y</Nullable>
					</Column>
				</Columns>
			</table>
		</Addition>
	</Additions>
	<Additions>
		<Version>V1.42</Version>
		<Addition>
			<Name>TableAdd</Name>
			<table>
				<Name>Locations</Name>
				<Columns>
					<Column>
						<Name>Id</Name>
						<Datatype>int</Datatype>
						<Nullable>N</Nullable>
						<Primary>Y</Primary>
						<AutoIncrement>Y</AutoIncrement>
					</Column>
					<Column>
						<Name>CompetitionsPerSeasonId</Name>
						<Datatype>int</Datatype>
						<Nullable>N</Nullable>
					</Column>
					<Column>
						<Name>Name</Name>
						<Datatype>varchar</Datatype>
						<Length>20</Length>
						<Nullable>Y</Nullable>
					</Column>
				</Columns>
				<Indices>
					<Index>
						<Name>IDX_Locations_CompPerSeasonId</Name>
						<Columns>
							<Column>
								<Name>CompetitionsPerSeasonId</Name>
							</Column>
						</Columns>
					</Index>
				</Indices>
				<Keys>
					<Key>
						<Name>FK_Locations_CompPerSeasonId</Name>
						<TypeE>FOREIGN</TypeE>
						<DeleteRule>C</DeleteRule>
						<UpdateRule>R</UpdateRule>
						<ReferencedByColumns>
							<Column>
								<Name>CompetitionsPerSeasonId</Name>
							</Column>
						</ReferencedByColumns>
						<ReferencingTable>
							<Name>CompetitionsPerSeason</Name>
							<Columns>
								<Column>
									<Name>Id</Name>
								</Column>
							</Columns>
						</ReferencingTable>
					</Key>
				</Keys>
			</table>
		</Addition>
	</Additions>
	<Additions>
		<Version>V1.43</Version>
		<Addition>
			<Name>ColumnAdd</Name>
			<table>
				<Name>Games</Name>
				<Columns>
					<Column>
						<Name>LocationId</Name>
						<Datatype>int</Datatype>
						<Nullable>Y</Nullable>
					</Column>
				</Columns>
			</table>
		</Addition>
		<Addition>
			<Name>IndexAdd</Name>
			<table>
				<Name>Games</Name>
				<Indices>
					<Index>
						<Name>IDX_Games_LocationId</Name>
						<Columns>
							<Column>
								<Name>LocationId</Name>
							</Column>
						</Columns>
					</Index>
				</Indices>
			</table>
		</Addition>
		<Addition>
			<Name>KeyAdd</Name>
			<table>
				<Name>Games</Name>
				<Keys>
					<Key>
						<Name>FK_Games_LocationId</Name>
						<TypeE>FOREIGN</TypeE>
						<DeleteRule>R</DeleteRule>
						<UpdateRule>R</UpdateRule>
						<ReferencedByColumns>
							<Column>
								<Name>LocationId</Name>
							</Column>
						</ReferencedByColumns>
						<ReferencingTable>
							<Name>Locations</Name>
							<Columns>
								<Column>
									<Name>Id</Name>
								</Column>
							</Columns>
						</ReferencingTable>
					</Key>
				</Keys>
			</table>
		</Addition>
	</Additions>
	<Additions>
		<Version>V1.44</Version>
		<Addition>
			<Name>QueryExecute</Name>
			<queries>
				<sql>insert into Locations( Name, CompetitionsPerSeasonId ) ( SELECT DISTINCT City, CompetitionsPerSeasonId FROM Games JOIN PoulePlaces ON PoulePlaces.Id = Games.HomePoulePlaceId JOIN Poules ON Poules.Id = PoulePlaces.PouleId JOIN Rounds ON Rounds.Id = Poules.RoundId )</sql>
				<sql>update Games G SET G.LocationId = ( SELECT Id FROM Locations WHERE Name = G.City ) WHERE G.City IS NOT NULL</sql>
			</queries>
		</Addition>
	</Additions>
	<Additions>
		<Version>V1.45</Version>
		<Addition>
			<Name>ColumnRemove</Name>
			<table>
				<Name>Games</Name>
				<Columns>
					<Column><Name>City</Name></Column>
				</Columns>
			</table>
		</Addition>
	</Additions>
	<Additions>
		<Version>V1.46</Version>
		<Addition>
			<Name>QueryExecute</Name>
			<queries>
				<sql>update Games set ValidatedDateTime = StartDateTime + INTERVAL 4 HOUR where ValidatedDateTime is null</sql><!-- UPGRADE OLD GAMES -->
			</queries>
		</Addition>
	</Additions>
</db>